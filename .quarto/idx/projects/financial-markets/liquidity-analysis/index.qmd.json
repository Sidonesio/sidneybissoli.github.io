{"title":"Liquidity Ratios Analysis - Brazilian Stock Market (B3)","markdown":{"yaml":{"title":"Liquidity Ratios Analysis - Brazilian Stock Market (B3)","subtitle":"Balance Sheet Analysis for Investment Decision Support","author":"Sidney Bissoli","date":"2025-08-05","categories":["Financial Market","B3","Liquidity Analysis","R"],"image":"liquidity_preview.png"},"headingText":"Overview","containsRefs":false,"markdown":"\n\n\nThis project demonstrates how to extract annual balance sheets from publicly traded companies listed on B3 (Brazilian stock exchange), and to calculate liquidity ratios (current, quick, immediate, and general) from this data, in order to inform investment decisions.\n\n## Methodology\n\nUsing R programming and financial data analysis techniques, this study focuses on four key liquidity ratios:\n\n-   **Current Ratio:** Current assets / Current liabilities\n\n-   **Quick Ratio:** (Current assets - Inventory) / Current liabilities\n\n-   **Immediate Ratio:** Cash and equivalents / Current liabilities\n\n-   **General Ratio:** (Current assets + Long-term assets) / (Current + Non-current liabilities)\n\n## Data Extraction and Preparation\n\n```{r}\n#| echo: true \n#| #| warning: false \n#| #| message: false\n#| # install pacman if it is not installed\n\n# install pacman if it is not installed\nif (!require(\"pacman\")) install.packages(\"pacman\")\n\n# install packages if they are not installed and load them\npacman::p_load(\n  tidyverse,\n  GetDFPData2,\n  janitor,\n  here,\n  scales,\n  ggthemes,\n  plotly,\n  DT,\n  crosstalk,\n  htmltools\n  )\n```\n\n```{r}\n#| echo: true\n#| warning: false\n#| message: false\n\n# store company name\ncia_name <- \"anima\"\n\n# get data\ndata_info <- get_info_companies()\n\n# subset companies currently traded on B3\ninfo_cleaned <- \n  data_info |>\n  clean_names() |>\n  rename(\n    name_social     = denom_social,\n    name_commercial = denom_comerc,\n    registro        = sit_reg,\n    code_cvm        = cd_cvm,\n    sector          = setor_ativ,\n    tipo            = tp_merc\n    ) |>\n  mutate(across(c(registro, tipo, sector), str_to_lower)) |>\n  filter(registro == \"ativo\") |>\n  filter(tipo == \"bolsa\") |>\n  mutate(sector = str_remove_all(sector, \".*- \"))\n\n# store company sector\ncia_sector <- \n  info_cleaned |>\n  filter(str_detect(name_social, str_to_upper(cia_name))) |>\n  pull(sector)\n\n# store company codes from the same economic sector of company chosen\ncvm_codes <- \n  info_cleaned |>\n  filter(sector == cia_sector) |>\n  pull(code_cvm)\n\n# download balance sheet data\nlist_bp  <- \n  get_dfp_data(\n    companies_cvm_codes = cvm_codes,\n    type_docs           = c(\"BPA\",\"BPP\"),\n    type_format         = \"con\",\n    clean_data          = TRUE,\n    use_memoise         = FALSE,\n    cache_folder        = \"gdfpd2_cache\"\n)\n```\n\n## Data Processing and Liquidity Calculations\n\n```{r}\n#| echo: true\n#| warning: false\n#| message: false\n\n# convert list into data set and provide basic manipulations\ndata_bp <-\n  list_bp |>\n  bind_rows() |>\n  clean_names() |>\n  rename(\n    cnpj        = cnpj_cia, \n    date        = dt_refer,\n    name        = denom_cia,\n    escala      = escala_moeda,\n    value       = vl_conta,\n    index       = cd_conta,\n    description = ds_conta\n    ) |>\n  mutate(across(c(escala, description), str_to_lower)) |>\n  mutate(value = case_when(\n    escala == \"mil\" ~ value * 1000,\n    TRUE            ~ value\n  ))\n\n# store company complete name\ncia_name_complete <- \n  data_bp |>\n  filter(str_detect(name, str_to_upper(cia_name))) |>\n  distinct(name) |>\n  pull(name)\n\n# store variables of interest\nvariables_chosen <- c(\n  \"ativo circulante\",\n  \"passivo circulante\",\n  \"caixa e equivalentes de caixa\",\n  \"ativo realizável a longo prazo\",\n  \"passivo não circulante\"\n)\n\n# store index for inventory (estoques)\nindex_chosen <- \"1.01.04\"\n\n# convert data to wide format\ndata_wide <-\n  data_bp |>\n  filter(description %in% variables_chosen | index %in% index_chosen) |>\n  select(date, name, description, value) |>\n  mutate(description = case_when(\n    str_detect(description, \"caixa\")              ~ \"caixa\",\n    str_detect(description, \"realizável\")         ~ \"at_realizavel\",\n    str_detect(description, \"não circulante\")     ~ \"pa_nao_circ\",\n    str_detect(description, \"ativo circulante\")   ~ \"at_circ\",\n    str_detect(description, \"passivo circulante\") ~ \"pa_circ\",\n    TRUE                                          ~ description\n  )) |>\n  pivot_wider(names_from = description, values_from = value) |>\n  group_by(date) |>\n  mutate(n = n()) |>\n  ungroup()\n\n# store abbreviated variables\nvariables_abbreviated <- c(\n  \"at_circ\",\n  \"pa_circ\",\n  \"caixa\",\n  \"at_realizavel\",\n  \"pa_nao_circ\",\n  \"estoques\"\n)\n\n# calculate sector totals\ndata_total <- \n  data_wide |>\n  select(-name) |>\n  group_by(date) |>\n  mutate(across(any_of(variables_abbreviated), sum, na.rm = TRUE)) |>\n  ungroup() |>\n  mutate(name = str_to_upper(\"total\"), .after = date) |>\n  distinct()\n\n# combine company data with sector averages\ndata_subset <-\n  data_wide |>\n  bind_rows(data_total) |>\n  mutate(name = str_to_lower(name)) |>\n  filter(str_detect(name, cia_name) | name == \"total\") |>\n  mutate(name = str_to_upper(name))\n\n# calculate liquidity ratios\ndata_multiplos <- \n  data_subset |> \n  mutate(\n    liq_corrente = at_circ / pa_circ,\n    liq_seca     = (at_circ - coalesce(estoques, 0)) / pa_circ,\n    liq_imediata = caixa / pa_circ,\n    liq_geral    = (at_circ + at_realizavel) / (pa_circ + pa_nao_circ)\n  ) |>\n  select(date, name, starts_with(\"liq\"), n)\n```\n\n```{r}\n#| echo: true\n#| warning: false\n#| message: false\n\n# order levels for classification\nlevels <- c(\n  \"adequate\", \n  \"regular\", \n  \"concerning\", \n  \"critical\"\n  )\n\n# prepare data for visualization with classification\ndata_classification <- \n  data_multiplos |>\n  group_by(date) |>\n  filter(n() == 2) |>\n  ungroup() |>\n  arrange(date) |>\n  pivot_longer(cols = starts_with(\"liq\"), names_to = \"variable\") |>\n  mutate(classification = case_when(\n    variable == \"liq_corrente\" & value < 1                   ~ \"critical\",\n    variable == \"liq_corrente\" & value >= 1   & value < 1.2  ~ \"concerning\",\n    variable == \"liq_corrente\" & value >= 1.2 & value < 1.5  ~ \"regular\",\n    variable == \"liq_corrente\" & value >= 1.5                ~ \"adequate\",\n    variable == \"liq_seca\"     & value < .8                  ~ \"critical\",\n    variable == \"liq_seca\"     & value >= .8  & value <=1    ~ \"concerning\",\n    variable == \"liq_seca\"     & value > 1                   ~ \"adequate\",\n    variable == \"liq_imediata\" & value < .15                 ~ \"critical\",\n    variable == \"liq_imediata\" & value >= .15 & value <=.3   ~ \"concerning\",\n    variable == \"liq_imediata\" & value > .3                  ~ \"adequate\",\n    variable == \"liq_geral\"    & value < 1                   ~ \"critical\",\n    variable == \"liq_geral\"    & value >= 1   & value < 1.2  ~ \"concerning\",\n    variable == \"liq_geral\"    & value >= 1.2 & value < 1.5  ~ \"regular\",\n    variable == \"liq_geral\"    & value >= 1.5                ~ \"adequate\",\n  )) |>\n  mutate(classification = str_to_title(classification)) |>\n  mutate(classification = factor(classification, levels = str_to_title(levels))) |>\n  mutate(year = year(date), .after = date)\n\n# nest data by liquidity type\ndata_nested <- \n  data_classification |>\n  nest(data = -variable)\n```\n\n## Interactive Liquidity Analysis Dashboard\n\n::: panel-tabset\n### Current Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create Current Ratio plot\ncurrent_data <- \n  data_nested |> \n  filter(variable == \"liq_corrente\") |> \n  pull(data) |> \n  pluck(1)\n\n# funtion to build  plots\ncreate_liquidity_plot <- function(data, type_name, full_name) {\n  \n  # get last year company count\n  n_last <- \n    data |> \n    slice_max(date) |> \n    distinct(n) |> \n    pull()\n  \n  # create plot\n  p <- \n    data |> \n    ggplot(aes(x = factor(year), y = value)) +\n    theme_classic() +\n    geom_col(\n      data    = data |> filter(str_detect(name, str_to_upper(cia_name))),\n      width   = .7,\n      mapping = aes(\n        fill = classification, \n        text = str_c(\n          \"Year: \", year, \"<br>\",\n          \"Value: \", round(value, 2), \"<br>\",\n          \"Classification: \", classification\n          )\n        ),\n      ) +\n    geom_point(\n      data    = data |> filter(str_detect(name, str_to_upper(\"total\"))),\n      color   = \"grey30\",\n      mapping = aes(text = str_c(\n        \"Sector Average<br>\",\n        \"Year: \", year, \"<br>\",\n        \"Value: \", round(value, 2)\n        ))\n      ) +\n    geom_line(\n      data  = data |> filter(str_detect(name, str_to_upper(\"total\"))),\n      color = \"grey30\",\n      group = 1\n    ) +\n    geom_text(\n      data    = data |> filter(str_detect(name, str_to_upper(cia_name))),\n    mapping = aes(label = round(value, 1), y = value * 0.8),\n      vjust   = 0.5,\n      color   = \"white\",\n      fontface = \"bold\"\n    ) +\n    scale_fill_manual(values = c(\n      \"Adequate\"   = \"green4\", \n      \"Regular\"    = \"royalblue3\", \n      \"Concerning\" = \"orange2\", \n      \"Critical\"   = \"red1\"\n      )) +\n    theme(\n      axis.text.x     = element_text(angle = 90, vjust = .5),\n      axis.text.y     = element_text(),\n      legend.position = \"bottom\",\n      plot.title      = element_text(size = 14, face = \"bold\"),\n      plot.subtitle   = element_text(size = 12)\n    ) +\n    labs(\n      x        = \"Year\",\n      y        = \"Ratio Value\",\n      title    = str_c(cia_name_complete, \": \", full_name),\n      fill     = \"Classification\",\n      subtitle = str_c(\"Compared to sector average (\", n_last, \" companies in latest year)\"),\n    ) +\n    scale_y_continuous(\n      expand = expansion(mult = c(0.02, 0.05)),\n      labels = number_format(accuracy = 0.1)  \n      )\n  \n  # convert to plotly\n  ggplotly(p, tooltip = \"text\") |>\n    layout(\n      title = list(\n        font = list(size = 14),\n        text = str_c(\n          cia_name_complete, \n          \": \", \n          full_name, \n          \"<br>\",\n          \"<sub>Compared to sector average (\", n_last, \" companies in latest year)</sub>\")\n        )\n      )\n}\n\n# Create and display Current Ratio plot\ncreate_liquidity_plot(current_data, \"corrente\", \"Current Liquidity Ratio\")\n```\n\n### Quick Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create Quick Ratio plot\nquick_data <- data_nested |> filter(variable == \"liq_seca\") |> pull(data) |> pluck(1)\n\ncreate_liquidity_plot(quick_data, \"seca\", \"Quick Liquidity Ratio\")\n\n```\n\n### Immediate Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create Immediate Ratio plot\nimmediate_data <- data_nested |> filter(variable == \"liq_imediata\") |> pull(data) |> pluck(1)\n\ncreate_liquidity_plot(immediate_data, \"imediata\", \"Immediate Liquidity Ratio\")\n```\n\n### General Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create General Ratio plot\ngeneral_data <- data_nested |> filter(variable == \"liq_geral\") |> pull(data) |> pluck(1)\n\ncreate_liquidity_plot(general_data, \"geral\", \"General Liquidity Ratio\")\n```\n:::\n\n## Summary Table\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# create summary table\nsummary_table <- \n data_multiplos |>\n  filter(str_detect(name, str_to_upper(cia_name))) |>\n  mutate(year = year(date)) |>\n  select(-n) |>\n  pivot_longer(\n    cols      = starts_with(\"liq\"), \n    names_to  = \"ratio\", \n    values_to = \"value\"\n  ) |>\n  mutate(\n    ratio = case_when(\n      ratio == \"liq_corrente\" ~ \"Current Ratio\",\n      ratio == \"liq_seca\"     ~ \"Quick Ratio\", \n      ratio == \"liq_imediata\" ~ \"Immediate Ratio\",\n      ratio == \"liq_geral\"    ~ \"General Ratio\"\n    ),\n    value = round(value, 2)\n  ) |>\n  select(ratio, year, value) |>\n  pivot_wider(names_from = year, values_from = value) |>\n  rename(Ratio = ratio)\n\n# display interactive table\ndatatable(\n  data    = summary_table, \n  options = list(scrollX = TRUE, pageLength = 4),\n  caption = str_c(\"Liquidity Ratios for \", cia_name_complete, \" by Year\")\n  )\n```\n\n## Key Findings\n\n### Company Performance vs. Sector Average\n\nThe analysis reveals important insights about **`r cia_name_complete`** liquidity position:\n\n1.  **Current Ratio Trends**: Shows the company's ability to meet short-term obligations\n\n2.  **Quick Ratio Analysis**: Excludes inventory to provide a more conservative liquidity measure\n\n3.  **Immediate Ratio**: Reveals cash position strength for urgent obligations\n\n4.  **General Ratio**: Provides comprehensive liquidity assessment including long-term assets\n\n### Classification System\n\nThe visualizations use a color-coded classification system:\n\n-   🟢 **Adequate (green)**: Strong liquidity position\n\n-   🔵 **Regular (blue)**: Acceptable liquidity levels\n\n-   🟠 **Concerning (orange)**: Attention required\n\n-   🔴 **Critical (red)**: Immediate attention needed\n\n## Investment Implications\n\nThis liquidity analysis provides valuable insights for:\n\n-   **Portfolio managers** seeking companies with solid financial foundations\n\n-   **Individual investors** evaluating investment safety and company stability\n\n-   **Financial analysts** comparing companies within the same economic sector\n\n-   **Risk managers** assessing short-term financial risk exposure\n\n## Technical Implementation\n\n**Data Sources:** B3 (Brazilian Stock Exchange) official financial reports\\\n**Analysis Tools:** R (tidyverse, GetDFPData2, ggplot2, plotly)\\\n**Methodology:** Balance sheet analysis with sector benchmarking\\\n**Interactivity:** Dynamic plots with hover information and classification tooltips\n\n\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n*This analysis demonstrates the integration of financial data extraction, statistical analysis, and interactive visualization techniques using R programming. The complete methodology can be adapted for analyzing any publicly traded company on B3.*\n","srcMarkdownNoYaml":"\n\n## Overview\n\nThis project demonstrates how to extract annual balance sheets from publicly traded companies listed on B3 (Brazilian stock exchange), and to calculate liquidity ratios (current, quick, immediate, and general) from this data, in order to inform investment decisions.\n\n## Methodology\n\nUsing R programming and financial data analysis techniques, this study focuses on four key liquidity ratios:\n\n-   **Current Ratio:** Current assets / Current liabilities\n\n-   **Quick Ratio:** (Current assets - Inventory) / Current liabilities\n\n-   **Immediate Ratio:** Cash and equivalents / Current liabilities\n\n-   **General Ratio:** (Current assets + Long-term assets) / (Current + Non-current liabilities)\n\n## Data Extraction and Preparation\n\n```{r}\n#| echo: true \n#| #| warning: false \n#| #| message: false\n#| # install pacman if it is not installed\n\n# install pacman if it is not installed\nif (!require(\"pacman\")) install.packages(\"pacman\")\n\n# install packages if they are not installed and load them\npacman::p_load(\n  tidyverse,\n  GetDFPData2,\n  janitor,\n  here,\n  scales,\n  ggthemes,\n  plotly,\n  DT,\n  crosstalk,\n  htmltools\n  )\n```\n\n```{r}\n#| echo: true\n#| warning: false\n#| message: false\n\n# store company name\ncia_name <- \"anima\"\n\n# get data\ndata_info <- get_info_companies()\n\n# subset companies currently traded on B3\ninfo_cleaned <- \n  data_info |>\n  clean_names() |>\n  rename(\n    name_social     = denom_social,\n    name_commercial = denom_comerc,\n    registro        = sit_reg,\n    code_cvm        = cd_cvm,\n    sector          = setor_ativ,\n    tipo            = tp_merc\n    ) |>\n  mutate(across(c(registro, tipo, sector), str_to_lower)) |>\n  filter(registro == \"ativo\") |>\n  filter(tipo == \"bolsa\") |>\n  mutate(sector = str_remove_all(sector, \".*- \"))\n\n# store company sector\ncia_sector <- \n  info_cleaned |>\n  filter(str_detect(name_social, str_to_upper(cia_name))) |>\n  pull(sector)\n\n# store company codes from the same economic sector of company chosen\ncvm_codes <- \n  info_cleaned |>\n  filter(sector == cia_sector) |>\n  pull(code_cvm)\n\n# download balance sheet data\nlist_bp  <- \n  get_dfp_data(\n    companies_cvm_codes = cvm_codes,\n    type_docs           = c(\"BPA\",\"BPP\"),\n    type_format         = \"con\",\n    clean_data          = TRUE,\n    use_memoise         = FALSE,\n    cache_folder        = \"gdfpd2_cache\"\n)\n```\n\n## Data Processing and Liquidity Calculations\n\n```{r}\n#| echo: true\n#| warning: false\n#| message: false\n\n# convert list into data set and provide basic manipulations\ndata_bp <-\n  list_bp |>\n  bind_rows() |>\n  clean_names() |>\n  rename(\n    cnpj        = cnpj_cia, \n    date        = dt_refer,\n    name        = denom_cia,\n    escala      = escala_moeda,\n    value       = vl_conta,\n    index       = cd_conta,\n    description = ds_conta\n    ) |>\n  mutate(across(c(escala, description), str_to_lower)) |>\n  mutate(value = case_when(\n    escala == \"mil\" ~ value * 1000,\n    TRUE            ~ value\n  ))\n\n# store company complete name\ncia_name_complete <- \n  data_bp |>\n  filter(str_detect(name, str_to_upper(cia_name))) |>\n  distinct(name) |>\n  pull(name)\n\n# store variables of interest\nvariables_chosen <- c(\n  \"ativo circulante\",\n  \"passivo circulante\",\n  \"caixa e equivalentes de caixa\",\n  \"ativo realizável a longo prazo\",\n  \"passivo não circulante\"\n)\n\n# store index for inventory (estoques)\nindex_chosen <- \"1.01.04\"\n\n# convert data to wide format\ndata_wide <-\n  data_bp |>\n  filter(description %in% variables_chosen | index %in% index_chosen) |>\n  select(date, name, description, value) |>\n  mutate(description = case_when(\n    str_detect(description, \"caixa\")              ~ \"caixa\",\n    str_detect(description, \"realizável\")         ~ \"at_realizavel\",\n    str_detect(description, \"não circulante\")     ~ \"pa_nao_circ\",\n    str_detect(description, \"ativo circulante\")   ~ \"at_circ\",\n    str_detect(description, \"passivo circulante\") ~ \"pa_circ\",\n    TRUE                                          ~ description\n  )) |>\n  pivot_wider(names_from = description, values_from = value) |>\n  group_by(date) |>\n  mutate(n = n()) |>\n  ungroup()\n\n# store abbreviated variables\nvariables_abbreviated <- c(\n  \"at_circ\",\n  \"pa_circ\",\n  \"caixa\",\n  \"at_realizavel\",\n  \"pa_nao_circ\",\n  \"estoques\"\n)\n\n# calculate sector totals\ndata_total <- \n  data_wide |>\n  select(-name) |>\n  group_by(date) |>\n  mutate(across(any_of(variables_abbreviated), sum, na.rm = TRUE)) |>\n  ungroup() |>\n  mutate(name = str_to_upper(\"total\"), .after = date) |>\n  distinct()\n\n# combine company data with sector averages\ndata_subset <-\n  data_wide |>\n  bind_rows(data_total) |>\n  mutate(name = str_to_lower(name)) |>\n  filter(str_detect(name, cia_name) | name == \"total\") |>\n  mutate(name = str_to_upper(name))\n\n# calculate liquidity ratios\ndata_multiplos <- \n  data_subset |> \n  mutate(\n    liq_corrente = at_circ / pa_circ,\n    liq_seca     = (at_circ - coalesce(estoques, 0)) / pa_circ,\n    liq_imediata = caixa / pa_circ,\n    liq_geral    = (at_circ + at_realizavel) / (pa_circ + pa_nao_circ)\n  ) |>\n  select(date, name, starts_with(\"liq\"), n)\n```\n\n```{r}\n#| echo: true\n#| warning: false\n#| message: false\n\n# order levels for classification\nlevels <- c(\n  \"adequate\", \n  \"regular\", \n  \"concerning\", \n  \"critical\"\n  )\n\n# prepare data for visualization with classification\ndata_classification <- \n  data_multiplos |>\n  group_by(date) |>\n  filter(n() == 2) |>\n  ungroup() |>\n  arrange(date) |>\n  pivot_longer(cols = starts_with(\"liq\"), names_to = \"variable\") |>\n  mutate(classification = case_when(\n    variable == \"liq_corrente\" & value < 1                   ~ \"critical\",\n    variable == \"liq_corrente\" & value >= 1   & value < 1.2  ~ \"concerning\",\n    variable == \"liq_corrente\" & value >= 1.2 & value < 1.5  ~ \"regular\",\n    variable == \"liq_corrente\" & value >= 1.5                ~ \"adequate\",\n    variable == \"liq_seca\"     & value < .8                  ~ \"critical\",\n    variable == \"liq_seca\"     & value >= .8  & value <=1    ~ \"concerning\",\n    variable == \"liq_seca\"     & value > 1                   ~ \"adequate\",\n    variable == \"liq_imediata\" & value < .15                 ~ \"critical\",\n    variable == \"liq_imediata\" & value >= .15 & value <=.3   ~ \"concerning\",\n    variable == \"liq_imediata\" & value > .3                  ~ \"adequate\",\n    variable == \"liq_geral\"    & value < 1                   ~ \"critical\",\n    variable == \"liq_geral\"    & value >= 1   & value < 1.2  ~ \"concerning\",\n    variable == \"liq_geral\"    & value >= 1.2 & value < 1.5  ~ \"regular\",\n    variable == \"liq_geral\"    & value >= 1.5                ~ \"adequate\",\n  )) |>\n  mutate(classification = str_to_title(classification)) |>\n  mutate(classification = factor(classification, levels = str_to_title(levels))) |>\n  mutate(year = year(date), .after = date)\n\n# nest data by liquidity type\ndata_nested <- \n  data_classification |>\n  nest(data = -variable)\n```\n\n## Interactive Liquidity Analysis Dashboard\n\n::: panel-tabset\n### Current Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create Current Ratio plot\ncurrent_data <- \n  data_nested |> \n  filter(variable == \"liq_corrente\") |> \n  pull(data) |> \n  pluck(1)\n\n# funtion to build  plots\ncreate_liquidity_plot <- function(data, type_name, full_name) {\n  \n  # get last year company count\n  n_last <- \n    data |> \n    slice_max(date) |> \n    distinct(n) |> \n    pull()\n  \n  # create plot\n  p <- \n    data |> \n    ggplot(aes(x = factor(year), y = value)) +\n    theme_classic() +\n    geom_col(\n      data    = data |> filter(str_detect(name, str_to_upper(cia_name))),\n      width   = .7,\n      mapping = aes(\n        fill = classification, \n        text = str_c(\n          \"Year: \", year, \"<br>\",\n          \"Value: \", round(value, 2), \"<br>\",\n          \"Classification: \", classification\n          )\n        ),\n      ) +\n    geom_point(\n      data    = data |> filter(str_detect(name, str_to_upper(\"total\"))),\n      color   = \"grey30\",\n      mapping = aes(text = str_c(\n        \"Sector Average<br>\",\n        \"Year: \", year, \"<br>\",\n        \"Value: \", round(value, 2)\n        ))\n      ) +\n    geom_line(\n      data  = data |> filter(str_detect(name, str_to_upper(\"total\"))),\n      color = \"grey30\",\n      group = 1\n    ) +\n    geom_text(\n      data    = data |> filter(str_detect(name, str_to_upper(cia_name))),\n    mapping = aes(label = round(value, 1), y = value * 0.8),\n      vjust   = 0.5,\n      color   = \"white\",\n      fontface = \"bold\"\n    ) +\n    scale_fill_manual(values = c(\n      \"Adequate\"   = \"green4\", \n      \"Regular\"    = \"royalblue3\", \n      \"Concerning\" = \"orange2\", \n      \"Critical\"   = \"red1\"\n      )) +\n    theme(\n      axis.text.x     = element_text(angle = 90, vjust = .5),\n      axis.text.y     = element_text(),\n      legend.position = \"bottom\",\n      plot.title      = element_text(size = 14, face = \"bold\"),\n      plot.subtitle   = element_text(size = 12)\n    ) +\n    labs(\n      x        = \"Year\",\n      y        = \"Ratio Value\",\n      title    = str_c(cia_name_complete, \": \", full_name),\n      fill     = \"Classification\",\n      subtitle = str_c(\"Compared to sector average (\", n_last, \" companies in latest year)\"),\n    ) +\n    scale_y_continuous(\n      expand = expansion(mult = c(0.02, 0.05)),\n      labels = number_format(accuracy = 0.1)  \n      )\n  \n  # convert to plotly\n  ggplotly(p, tooltip = \"text\") |>\n    layout(\n      title = list(\n        font = list(size = 14),\n        text = str_c(\n          cia_name_complete, \n          \": \", \n          full_name, \n          \"<br>\",\n          \"<sub>Compared to sector average (\", n_last, \" companies in latest year)</sub>\")\n        )\n      )\n}\n\n# Create and display Current Ratio plot\ncreate_liquidity_plot(current_data, \"corrente\", \"Current Liquidity Ratio\")\n```\n\n### Quick Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create Quick Ratio plot\nquick_data <- data_nested |> filter(variable == \"liq_seca\") |> pull(data) |> pluck(1)\n\ncreate_liquidity_plot(quick_data, \"seca\", \"Quick Liquidity Ratio\")\n\n```\n\n### Immediate Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create Immediate Ratio plot\nimmediate_data <- data_nested |> filter(variable == \"liq_imediata\") |> pull(data) |> pluck(1)\n\ncreate_liquidity_plot(immediate_data, \"imediata\", \"Immediate Liquidity Ratio\")\n```\n\n### General Ratio\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# Create General Ratio plot\ngeneral_data <- data_nested |> filter(variable == \"liq_geral\") |> pull(data) |> pluck(1)\n\ncreate_liquidity_plot(general_data, \"geral\", \"General Liquidity Ratio\")\n```\n:::\n\n## Summary Table\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n\n# create summary table\nsummary_table <- \n data_multiplos |>\n  filter(str_detect(name, str_to_upper(cia_name))) |>\n  mutate(year = year(date)) |>\n  select(-n) |>\n  pivot_longer(\n    cols      = starts_with(\"liq\"), \n    names_to  = \"ratio\", \n    values_to = \"value\"\n  ) |>\n  mutate(\n    ratio = case_when(\n      ratio == \"liq_corrente\" ~ \"Current Ratio\",\n      ratio == \"liq_seca\"     ~ \"Quick Ratio\", \n      ratio == \"liq_imediata\" ~ \"Immediate Ratio\",\n      ratio == \"liq_geral\"    ~ \"General Ratio\"\n    ),\n    value = round(value, 2)\n  ) |>\n  select(ratio, year, value) |>\n  pivot_wider(names_from = year, values_from = value) |>\n  rename(Ratio = ratio)\n\n# display interactive table\ndatatable(\n  data    = summary_table, \n  options = list(scrollX = TRUE, pageLength = 4),\n  caption = str_c(\"Liquidity Ratios for \", cia_name_complete, \" by Year\")\n  )\n```\n\n## Key Findings\n\n### Company Performance vs. Sector Average\n\nThe analysis reveals important insights about **`r cia_name_complete`** liquidity position:\n\n1.  **Current Ratio Trends**: Shows the company's ability to meet short-term obligations\n\n2.  **Quick Ratio Analysis**: Excludes inventory to provide a more conservative liquidity measure\n\n3.  **Immediate Ratio**: Reveals cash position strength for urgent obligations\n\n4.  **General Ratio**: Provides comprehensive liquidity assessment including long-term assets\n\n### Classification System\n\nThe visualizations use a color-coded classification system:\n\n-   🟢 **Adequate (green)**: Strong liquidity position\n\n-   🔵 **Regular (blue)**: Acceptable liquidity levels\n\n-   🟠 **Concerning (orange)**: Attention required\n\n-   🔴 **Critical (red)**: Immediate attention needed\n\n## Investment Implications\n\nThis liquidity analysis provides valuable insights for:\n\n-   **Portfolio managers** seeking companies with solid financial foundations\n\n-   **Individual investors** evaluating investment safety and company stability\n\n-   **Financial analysts** comparing companies within the same economic sector\n\n-   **Risk managers** assessing short-term financial risk exposure\n\n## Technical Implementation\n\n**Data Sources:** B3 (Brazilian Stock Exchange) official financial reports\\\n**Analysis Tools:** R (tidyverse, GetDFPData2, ggplot2, plotly)\\\n**Methodology:** Balance sheet analysis with sector benchmarking\\\n**Interactivity:** Dynamic plots with hover information and classification tooltips\n\n\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n*This analysis demonstrates the integration of financial data extraction, statistical analysis, and interactive visualization techniques using R programming. The complete methodology can be adapted for analyzing any publicly traded company on B3.*\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"css":["../../../styles.css"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","theme":"cosmo","fontsize":"1.1em","linestretch":1.6,"toc-location":"right","page-layout":"article","title":"Liquidity Ratios Analysis - Brazilian Stock Market (B3)","subtitle":"Balance Sheet Analysis for Investment Decision Support","author":"Sidney Bissoli","date":"2025-08-05","categories":["Financial Market","B3","Liquidity Analysis","R"],"image":"liquidity_preview.png"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}